{"version":3,"file":"keycon.esm.js","sources":["../src/utils.ts","../src/KeyController.ts","../src/reactive.ts"],"sourcesContent":["import { names } from \"keycode\";\n\nconst codeData = {\n    \"+\": \"plus\",\n    \"left command\": \"meta\",\n    \"right command\": \"meta\",\n};\nconst keysSort = {\n    shift: 1,\n    ctrl: 2,\n    alt: 3,\n    meta: 4,\n};\n\n/**\n * @memberof KeyController\n */\nexport function getKey(keyCode: number, keyName?: string): string {\n    let key = (names[keyCode] || keyName || \"\").toLowerCase();\n\n    for (const name in codeData) {\n        key = key.replace(name, codeData[name]);\n    }\n    return key.replace(/\\s/g, \"\");\n}\n\n/**\n * @memberof KeyController\n */\nexport function getCombi(e: KeyboardEvent, key: string = getKey(e.keyCode, e.key)): string[] {\n    const keys = getModifierCombi(e);\n    keys.indexOf(key) === -1 && keys.push(key);\n\n    return keys.filter(Boolean);\n}\n\n/**\n * @memberof KeyController\n */\nexport function getModifierCombi(e: KeyboardEvent): string[] {\n    const keys = [e.shiftKey && \"shift\", e.ctrlKey && \"ctrl\", e.altKey && \"alt\", e.metaKey && \"meta\"];\n\n    return keys.filter(Boolean);\n}\n\n/**\n * @memberof KeyController\n */\nexport function getArrangeCombi(keys: string[]) {\n    const arrangeKeys = keys.slice();\n    arrangeKeys.sort((prev, next) => {\n        const prevScore = keysSort[prev] || 5;\n        const nextScore = keysSort[next] || 5;\n\n        return prevScore - nextScore;\n    });\n\n    return arrangeKeys;\n}\n","import EventEmitter, { EmitterParam, TargetParam } from \"@scena/event-emitter\";\n\nimport { isString, isArray, addEvent, removeEvent } from \"@daybrush/utils\";\nimport { getArrangeCombi, getKey, getCombi } from \"./utils\";\n\n/**\n * @typedef\n * @memberof KeyController\n */\nexport interface KeyControllerEvent extends EmitterParam {\n    inputEvent: KeyboardEvent;\n    isToggle: boolean;\n    key: string;\n    keyCode: number;\n    ctrlKey: boolean;\n    altKey: boolean;\n    shiftKey: boolean;\n    metaKey: boolean;\n}\n\nexport interface OnKeydown extends KeyControllerEvent {\n\n}\nexport interface OnKeyup extends KeyControllerEvent {\n\n}\nexport interface OnBlur {\n\n}\nexport interface KeyconEvents {\n    keydown: OnKeydown;\n    keyup: OnKeyup;\n    blur: OnBlur;\n}\nexport type KeyControllerEvents = KeyconEvents;\n\nlet globalKeyController!: KeyController;\n\n/**\n */\nclass KeyController extends EventEmitter<KeyconEvents & { [text: string]: any }> {\n    /**\n     */\n    public static get global() {\n        return globalKeyController || (globalKeyController = new KeyController());\n    }\n    public static setGlobal() {\n        return this.global;\n    }\n    /**\n     */\n    public ctrlKey = false;\n    /**\n     */\n    public altKey = false;\n    /**\n     *\n     */\n    public shiftKey = false;\n    /**\n     *\n     */\n    public metaKey = false;\n    /**\n     *\n     */\n    constructor(public container: Window | Document | HTMLElement = window) {\n        super();\n\n        addEvent(container, \"blur\", this.blur);\n        addEvent(container, \"keydown\", this.keydownEvent);\n        addEvent(container, \"keyup\", this.keyupEvent);\n    }\n    public clear = (): this => {\n        this.ctrlKey = false;\n        this.altKey = false;\n        this.shiftKey = false;\n        this.metaKey = false;\n        return this;\n    }\n    /**\n     *\n     */\n    public destroy() {\n        const container = this.container as any;\n\n        this.clear();\n        this.off();\n        removeEvent(container, \"blur\", this.blur);\n        removeEvent(container, \"keydown\", this.keydownEvent);\n        removeEvent(container, \"keyup\", this.keyupEvent);\n    }\n    public keydown(comb: string | string[], callback: (e: KeyControllerEvent) => void): this;\n    public keydown(callback: (e: KeyControllerEvent) => void): this;\n    /**\n     *\n     */\n    public keydown(\n        comb: string | string[] | ((e: KeyControllerEvent) => void),\n        callback?: (e: KeyControllerEvent) => void,\n    ): this {\n        return this.addEvent(\"keydown\", comb, callback);\n    }\n    public offKeydown(comb: string | string[], callback?: (e: KeyControllerEvent) => void): this;\n    public offKeydown(callback: (e: KeyControllerEvent) => void): this;\n    /**\n     *\n     */\n    public offKeydown(\n        comb: string | string[] | ((e: KeyControllerEvent) => void),\n        callback?: (e: KeyControllerEvent) => void,\n    ): this {\n        return this.removeEvent(\"keydown\", comb, callback);\n    }\n    public offKeyup(comb: string | string[], callback?: (e: KeyControllerEvent) => void): this;\n    public offKeyup(callback: (e: KeyControllerEvent) => void): this;\n    /**\n     *\n     */\n    public offKeyup(\n        comb: string | string[] | ((e: KeyControllerEvent) => void),\n        callback?: (e: KeyControllerEvent) => void,\n    ): this {\n        return this.removeEvent(\"keyup\", comb, callback);\n    }\n    public keyup(comb: string | string[], callback: (e: KeyControllerEvent) => void): this;\n    public keyup(callback: (e: KeyControllerEvent) => void): this;\n    /**\n     *\n     */\n    public keyup(\n        comb: string | string[] | ((e: KeyControllerEvent) => void),\n        callback?: (e: KeyControllerEvent) => void,\n    ): this {\n        return this.addEvent(\"keyup\", comb, callback);\n    }\n    private addEvent(\n        type: \"keydown\" | \"keyup\",\n        comb: string | string[] | ((e: KeyControllerEvent) => void),\n        callback?: (e: KeyControllerEvent) => void,\n    ) {\n        if (isArray(comb)) {\n            this.on(`${type}.${getArrangeCombi(comb).join(\".\")}`, callback);\n        } else if (isString(comb)) {\n            this.on(`${type}.${comb}`, callback);\n        } else {\n            this.on(type, comb);\n        }\n        return this;\n    }\n    private removeEvent(\n        type: \"keydown\" | \"keyup\",\n        comb: string | string[] | ((e: KeyControllerEvent) => void) | undefined,\n        callback?: (e: KeyControllerEvent) => void,\n    ) {\n        if (isArray(comb)) {\n            this.off(`${type}.${getArrangeCombi(comb).join(\".\")}`, callback);\n        } else if (isString(comb)) {\n            this.off(`${type}.${comb}`, callback);\n        } else {\n            this.off(type, comb);\n        }\n        return this;\n    }\n    private triggerEvent(type: \"keydown\" | \"keyup\", e: KeyboardEvent) {\n        this.ctrlKey = e.ctrlKey;\n        this.shiftKey = e.shiftKey;\n        this.altKey = e.altKey;\n        this.metaKey = e.metaKey;\n\n        const key = getKey(e.keyCode, e.key);\n        const isToggle = key === \"ctrl\"\n            || key === \"shift\"\n            || key === \"meta\"\n            || key === \"alt\";\n        const param: TargetParam<KeyControllerEvent> = {\n            key,\n            isToggle,\n            inputEvent: e,\n            keyCode: e.keyCode,\n            ctrlKey: e.ctrlKey,\n            altKey: e.altKey,\n            shiftKey: e.shiftKey,\n            metaKey: e.metaKey,\n        };\n        this.trigger(type, param);\n        this.trigger(`${type}.${key}`, param);\n\n        const combi = getCombi(e, key);\n\n        combi.length > 1 && this.trigger(`${type}.${combi.join(\".\")}`, param);\n    }\n    private keydownEvent = (e: KeyboardEvent) => {\n        this.triggerEvent(\"keydown\", e);\n    }\n    private keyupEvent = (e: KeyboardEvent) => {\n        this.triggerEvent(\"keyup\", e);\n    }\n    private blur = () => {\n        this.clear();\n        this.trigger(\"blur\");\n    }\n}\n\nexport default KeyController;\n","import { ReactiveAdapter, reactive, Ref, observe, ReactiveObject, Observer } from \"@cfcs/core\";\nimport KeyController, { KeyControllerEvents, KeyControllerEvent } from \"./KeyController\";\n\nexport interface ReactiveKeyControllerData {\n    ref?: Ref<HTMLElement | null | undefined>;\n    checker?: (e: KeyControllerEvent) => boolean;\n    keys: string | string[];\n}\n\nexport type ReactiveKeyController = ReactiveObject<{\n    inst: KeyController;\n    keys: string | string[];\n    isKeydown: Observer<boolean>;\n    destroy(): void;\n}>;\n\nlet instanceMap!: Map<HTMLElement | Window | Document, {\n    inst: KeyController;\n    count: number;\n}>;\n\nexport const REACTIVE: ReactiveAdapter<\n    ReactiveKeyController,\n    { isKeydown: boolean },\n    never,\n    ReactiveKeyControllerData,\n    KeyControllerEvents\n> = {\n    events: [\"keydown\", \"keyup\", \"blur\"],\n    state: { isKeydown: false },\n    mounted(data) {\n        if (!instanceMap) {\n            instanceMap = new Map();\n        }\n        const element = data.ref?.current ?? window;\n\n        let info = instanceMap.get(element);\n\n        if (!info) {\n            info = {\n                inst: new KeyController(element),\n                count: 0,\n            };\n\n            instanceMap.set(element, info);\n        }\n        ++info.count;\n\n        const keycon = info.inst;\n        const keys = data.keys;\n        const isKeydown = observe(false);\n        const checker = data.checker;\n\n        keycon.keydown(keys, (e: KeyControllerEvent) => {\n            if (!checker || checker(e)) {\n                isKeydown.current = true;\n            }\n        });\n        keycon.keyup(keys, () => {\n            isKeydown.current = false;\n        });\n        keycon.on(\"blur\", () => {\n            isKeydown.current = false;\n        });\n\n        return reactive({\n            inst: keycon,\n            keys,\n            destroy: () => keycon.destroy(),\n            isKeydown,\n        });\n    },\n    destroy({ inst }) {\n        const element = inst.container;\n        const info = instanceMap.get(element);\n\n        --info.count;\n        if (!info.count) {\n            inst.destroy();\n            instanceMap.delete(element);\n        }\n    },\n    on(inst, name, callback) {\n        const keycon = inst.inst;\n\n        if (name === \"keydown\") {\n            keycon.keydown(inst.keys, callback as any);\n        } else if (name === \"keyup\") {\n            keycon.keyup(inst.keys, callback as any);\n        } else {\n            keycon.on(name, callback as any);\n        }\n    },\n    off(inst, name, callback) {\n        const keycon = inst.inst;\n\n        if (name === \"keydown\") {\n            keycon.offKeydown(inst.keys, callback as any);\n        } else if (name === \"keyup\") {\n            keycon.offKeyup(inst.keys, callback as any);\n        } else {\n            keycon.off(name, callback as any);\n        }\n    },\n}\n"],"names":["codeData","keysSort","shift","ctrl","alt","meta","getKey","keyCode","keyName","key","names","toLowerCase","name","replace","getCombi","e","keys","getModifierCombi","indexOf","push","filter","Boolean","shiftKey","ctrlKey","altKey","metaKey","getArrangeCombi","arrangeKeys","slice","sort","prev","next","prevScore","nextScore","globalKeyController","__extends","container","_super","_this","triggerEvent","clear","trigger","addEvent","blur","keydownEvent","keyupEvent","Object","KeyController","global","off","removeEvent","comb","callback","type","isArray","on","join","isString","isToggle","param","inputEvent","combi","length","EventEmitter","instanceMap","REACTIVE","events","state","isKeydown","mounted","data","Map","element","ref","current","window","info","get","inst","count","set","keycon","observe","checker","keydown","keyup","reactive","destroy","_a","delete","offKeydown","offKeyup"],"mappings":"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"}