{"version":3,"file":"keycon.js","sources":["../src/utils.ts","../src/KeyController.ts","../src/reactive.ts","../src/index.umd.ts"],"sourcesContent":["import { names } from \"keycode\";\n\nconst codeData = {\n    \"+\": \"plus\",\n    \"left command\": \"meta\",\n    \"right command\": \"meta\",\n};\nconst keysSort = {\n    shift: 1,\n    ctrl: 2,\n    alt: 3,\n    meta: 4,\n};\n\n/**\n * @memberof KeyController\n */\nexport function getKey(keyCode: number, keyName?: string): string {\n    let key = (names[keyCode] || keyName || \"\").toLowerCase();\n\n    for (const name in codeData) {\n        key = key.replace(name, codeData[name]);\n    }\n    return key.replace(/\\s/g, \"\");\n}\n\n/**\n * @memberof KeyController\n */\nexport function getCombi(e: KeyboardEvent, key: string = getKey(e.keyCode, e.key)): string[] {\n    const keys = getModifierCombi(e);\n    keys.indexOf(key) === -1 && keys.push(key);\n\n    return keys.filter(Boolean);\n}\n\n/**\n * @memberof KeyController\n */\nexport function getModifierCombi(e: KeyboardEvent): string[] {\n    const keys = [e.shiftKey && \"shift\", e.ctrlKey && \"ctrl\", e.altKey && \"alt\", e.metaKey && \"meta\"];\n\n    return keys.filter(Boolean);\n}\n\n/**\n * @memberof KeyController\n */\nexport function getArrangeCombi(keys: string[]) {\n    const arrangeKeys = keys.slice();\n    arrangeKeys.sort((prev, next) => {\n        const prevScore = keysSort[prev] || 5;\n        const nextScore = keysSort[next] || 5;\n\n        return prevScore - nextScore;\n    });\n\n    return arrangeKeys;\n}\n","import EventEmitter, { EmitterParam, TargetParam } from \"@scena/event-emitter\";\n\nimport { isString, isArray, addEvent, removeEvent } from \"@daybrush/utils\";\nimport { getArrangeCombi, getKey, getCombi } from \"./utils\";\n\n/**\n * @typedef\n * @memberof KeyController\n */\nexport interface KeyControllerEvent extends EmitterParam {\n    inputEvent: KeyboardEvent;\n    isToggle: boolean;\n    key: string;\n    keyCode: number;\n    ctrlKey: boolean;\n    altKey: boolean;\n    shiftKey: boolean;\n    metaKey: boolean;\n}\n\nexport interface OnKeydown extends KeyControllerEvent {\n\n}\nexport interface OnKeyup extends KeyControllerEvent {\n\n}\nexport interface OnBlur {\n\n}\nexport interface KeyconEvents {\n    keydown: OnKeydown;\n    keyup: OnKeyup;\n    blur: OnBlur;\n}\nexport type KeyControllerEvents = KeyconEvents;\n\nlet globalKeyController!: KeyController;\n\n/**\n */\nclass KeyController extends EventEmitter<KeyconEvents & { [text: string]: any }> {\n    /**\n     */\n    public static get global() {\n        return globalKeyController || (globalKeyController = new KeyController());\n    }\n    public static setGlobal() {\n        return this.global;\n    }\n    /**\n     */\n    public ctrlKey = false;\n    /**\n     */\n    public altKey = false;\n    /**\n     *\n     */\n    public shiftKey = false;\n    /**\n     *\n     */\n    public metaKey = false;\n    /**\n     *\n     */\n    constructor(public container: Window | Document | HTMLElement = window) {\n        super();\n\n        addEvent(container, \"blur\", this.blur);\n        addEvent(container, \"keydown\", this.keydownEvent);\n        addEvent(container, \"keyup\", this.keyupEvent);\n    }\n    public clear = (): this => {\n        this.ctrlKey = false;\n        this.altKey = false;\n        this.shiftKey = false;\n        this.metaKey = false;\n        return this;\n    }\n    /**\n     *\n     */\n    public destroy() {\n        const container = this.container as any;\n\n        this.clear();\n        this.off();\n        removeEvent(container, \"blur\", this.blur);\n        removeEvent(container, \"keydown\", this.keydownEvent);\n        removeEvent(container, \"keyup\", this.keyupEvent);\n    }\n    public keydown(comb: string | string[], callback: (e: KeyControllerEvent) => void): this;\n    public keydown(callback: (e: KeyControllerEvent) => void): this;\n    /**\n     *\n     */\n    public keydown(\n        comb: string | string[] | ((e: KeyControllerEvent) => void),\n        callback?: (e: KeyControllerEvent) => void,\n    ): this {\n        return this.addEvent(\"keydown\", comb, callback);\n    }\n    public offKeydown(comb: string | string[], callback?: (e: KeyControllerEvent) => void): this;\n    public offKeydown(callback: (e: KeyControllerEvent) => void): this;\n    /**\n     *\n     */\n    public offKeydown(\n        comb: string | string[] | ((e: KeyControllerEvent) => void),\n        callback?: (e: KeyControllerEvent) => void,\n    ): this {\n        return this.removeEvent(\"keydown\", comb, callback);\n    }\n    public offKeyup(comb: string | string[], callback?: (e: KeyControllerEvent) => void): this;\n    public offKeyup(callback: (e: KeyControllerEvent) => void): this;\n    /**\n     *\n     */\n    public offKeyup(\n        comb: string | string[] | ((e: KeyControllerEvent) => void),\n        callback?: (e: KeyControllerEvent) => void,\n    ): this {\n        return this.removeEvent(\"keyup\", comb, callback);\n    }\n    public keyup(comb: string | string[], callback: (e: KeyControllerEvent) => void): this;\n    public keyup(callback: (e: KeyControllerEvent) => void): this;\n    /**\n     *\n     */\n    public keyup(\n        comb: string | string[] | ((e: KeyControllerEvent) => void),\n        callback?: (e: KeyControllerEvent) => void,\n    ): this {\n        return this.addEvent(\"keyup\", comb, callback);\n    }\n    private addEvent(\n        type: \"keydown\" | \"keyup\",\n        comb: string | string[] | ((e: KeyControllerEvent) => void),\n        callback?: (e: KeyControllerEvent) => void,\n    ) {\n        if (isArray(comb)) {\n            this.on(`${type}.${getArrangeCombi(comb).join(\".\")}`, callback);\n        } else if (isString(comb)) {\n            this.on(`${type}.${comb}`, callback);\n        } else {\n            this.on(type, comb);\n        }\n        return this;\n    }\n    private removeEvent(\n        type: \"keydown\" | \"keyup\",\n        comb: string | string[] | ((e: KeyControllerEvent) => void) | undefined,\n        callback?: (e: KeyControllerEvent) => void,\n    ) {\n        if (isArray(comb)) {\n            this.off(`${type}.${getArrangeCombi(comb).join(\".\")}`, callback);\n        } else if (isString(comb)) {\n            this.off(`${type}.${comb}`, callback);\n        } else {\n            this.off(type, comb);\n        }\n        return this;\n    }\n    private triggerEvent(type: \"keydown\" | \"keyup\", e: KeyboardEvent) {\n        this.ctrlKey = e.ctrlKey;\n        this.shiftKey = e.shiftKey;\n        this.altKey = e.altKey;\n        this.metaKey = e.metaKey;\n\n        const key = getKey(e.keyCode, e.key);\n        const isToggle = key === \"ctrl\"\n            || key === \"shift\"\n            || key === \"meta\"\n            || key === \"alt\";\n        const param: TargetParam<KeyControllerEvent> = {\n            key,\n            isToggle,\n            inputEvent: e,\n            keyCode: e.keyCode,\n            ctrlKey: e.ctrlKey,\n            altKey: e.altKey,\n            shiftKey: e.shiftKey,\n            metaKey: e.metaKey,\n        };\n        this.trigger(type, param);\n        this.trigger(`${type}.${key}`, param);\n\n        const combi = getCombi(e, key);\n\n        combi.length > 1 && this.trigger(`${type}.${combi.join(\".\")}`, param);\n    }\n    private keydownEvent = (e: KeyboardEvent) => {\n        this.triggerEvent(\"keydown\", e);\n    }\n    private keyupEvent = (e: KeyboardEvent) => {\n        this.triggerEvent(\"keyup\", e);\n    }\n    private blur = () => {\n        this.clear();\n        this.trigger(\"blur\");\n    }\n}\n\nexport default KeyController;\n","import { ReactiveAdapter, reactive, Ref, observe, ReactiveObject, Observer } from \"@cfcs/core\";\nimport KeyController, { KeyControllerEvents, KeyControllerEvent } from \"./KeyController\";\n\nexport interface ReactiveKeyControllerData {\n    ref?: Ref<HTMLElement | null | undefined>;\n    checker?: (e: KeyControllerEvent) => boolean;\n    keys: string | string[];\n}\n\nexport type ReactiveKeyController = ReactiveObject<{\n    inst: KeyController;\n    keys: string | string[];\n    isKeydown: Observer<boolean>;\n    destroy(): void;\n}>;\n\nlet instanceMap!: Map<HTMLElement | Window | Document, {\n    inst: KeyController;\n    count: number;\n}>;\n\nexport const REACTIVE: ReactiveAdapter<\n    ReactiveKeyController,\n    { isKeydown: boolean },\n    never,\n    ReactiveKeyControllerData,\n    KeyControllerEvents\n> = {\n    events: [\"keydown\", \"keyup\", \"blur\"],\n    state: { isKeydown: false },\n    mounted(data) {\n        if (!instanceMap) {\n            instanceMap = new Map();\n        }\n        const element = data.ref?.current ?? window;\n\n        let info = instanceMap.get(element);\n\n        if (!info) {\n            info = {\n                inst: new KeyController(element),\n                count: 0,\n            };\n\n            instanceMap.set(element, info);\n        }\n        ++info.count;\n\n        const keycon = info.inst;\n        const keys = data.keys;\n        const isKeydown = observe(false);\n        const checker = data.checker;\n\n        keycon.keydown(keys, (e: KeyControllerEvent) => {\n            if (!checker || checker(e)) {\n                isKeydown.current = true;\n            }\n        });\n        keycon.keyup(keys, () => {\n            isKeydown.current = false;\n        });\n        keycon.on(\"blur\", () => {\n            isKeydown.current = false;\n        });\n\n        return reactive({\n            inst: keycon,\n            keys,\n            destroy: () => keycon.destroy(),\n            isKeydown,\n        });\n    },\n    destroy({ inst }) {\n        const element = inst.container;\n        const info = instanceMap.get(element);\n\n        --info.count;\n        if (!info.count) {\n            inst.destroy();\n            instanceMap.delete(element);\n        }\n    },\n    on(inst, name, callback) {\n        const keycon = inst.inst;\n\n        if (name === \"keydown\") {\n            keycon.keydown(inst.keys, callback as any);\n        } else if (name === \"keyup\") {\n            keycon.keyup(inst.keys, callback as any);\n        } else {\n            keycon.on(name, callback as any);\n        }\n    },\n    off(inst, name, callback) {\n        const keycon = inst.inst;\n\n        if (name === \"keydown\") {\n            keycon.offKeydown(inst.keys, callback as any);\n        } else if (name === \"keyup\") {\n            keycon.offKeyup(inst.keys, callback as any);\n        } else {\n            keycon.off(name, callback as any);\n        }\n    },\n}\n","import keycon, * as others from \"./index\";\n\nfor (const name in others) {\n    (keycon as any)[name] = (others as any)[name];\n}\nexport default keycon;\n"],"names":["codeData","keysSort","shift","ctrl","alt","meta","getKey","keyCode","keyName","key","names","toLowerCase","name","replace","getCombi","e","keys","getModifierCombi","indexOf","push","filter","Boolean","shiftKey","ctrlKey","altKey","metaKey","getArrangeCombi","arrangeKeys","slice","sort","prev","next","prevScore","nextScore","globalKeyController","__extends","container","_super","_this","triggerEvent","clear","trigger","addEvent","blur","keydownEvent","keyupEvent","Object","KeyController","global","off","removeEvent","comb","callback","type","isArray","on","join","isString","isToggle","param","inputEvent","combi","length","EventEmitter","instanceMap","REACTIVE","events","state","isKeydown","mounted","data","Map","element","ref","current","window","info","get","inst","count","set","keycon","observe","checker","keydown","keyup","reactive","destroy","_a","delete","offKeydown","offKeyup","others"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAEA,IAAMA,QAAQ,GAAG;MACb,GAAG,EAAE,MAAM;MACX,cAAc,EAAE,MAAM;MACtB,eAAe,EAAE;KACpB;IACD,IAAMC,QAAQ,GAAG;MACbC,KAAK,EAAE,CAAC;MACRC,IAAI,EAAE,CAAC;MACPC,GAAG,EAAE,CAAC;MACNC,IAAI,EAAE;KACT;IAED;;;AAGA,aAAgBC,MAAM,CAACC,OAAe,EAAEC,OAAgB;MACpD,IAAIC,GAAG,GAAG,CAACC,SAAK,CAACH,OAAO,CAAC,IAAIC,OAAO,IAAI,EAAE,EAAEG,WAAW,EAAE;MAEzD,KAAK,IAAMC,IAAI,IAAIZ,QAAQ,EAAE;QACzBS,GAAG,GAAGA,GAAG,CAACI,OAAO,CAACD,IAAI,EAAEZ,QAAQ,CAACY,IAAI,CAAC,CAAC;;MAE3C,OAAOH,GAAG,CAACI,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC;IACjC;IAEA;;;AAGA,aAAgBC,QAAQ,CAACC,CAAgB,EAAEN,GAAsC;MAAtC,oBAAA;QAAAA,MAAcH,MAAM,CAACS,CAAC,CAACR,OAAO,EAAEQ,CAAC,CAACN,GAAG,CAAC;;MAC7E,IAAMO,IAAI,GAAGC,gBAAgB,CAACF,CAAC,CAAC;MAChCC,IAAI,CAACE,OAAO,CAACT,GAAG,CAAC,KAAK,CAAC,CAAC,IAAIO,IAAI,CAACG,IAAI,CAACV,GAAG,CAAC;MAE1C,OAAOO,IAAI,CAACI,MAAM,CAACC,OAAO,CAAC;IAC/B;IAEA;;;AAGA,aAAgBJ,gBAAgB,CAACF,CAAgB;MAC7C,IAAMC,IAAI,GAAG,CAACD,CAAC,CAACO,QAAQ,IAAI,OAAO,EAAEP,CAAC,CAACQ,OAAO,IAAI,MAAM,EAAER,CAAC,CAACS,MAAM,IAAI,KAAK,EAAET,CAAC,CAACU,OAAO,IAAI,MAAM,CAAC;MAEjG,OAAOT,IAAI,CAACI,MAAM,CAACC,OAAO,CAAC;IAC/B;IAEA;;;AAGA,aAAgBK,eAAe,CAACV,IAAc;MAC1C,IAAMW,WAAW,GAAGX,IAAI,CAACY,KAAK,EAAE;MAChCD,WAAW,CAACE,IAAI,CAAC,UAACC,IAAI,EAAEC,IAAI;QACxB,IAAMC,SAAS,GAAG/B,QAAQ,CAAC6B,IAAI,CAAC,IAAI,CAAC;QACrC,IAAMG,SAAS,GAAGhC,QAAQ,CAAC8B,IAAI,CAAC,IAAI,CAAC;QAErC,OAAOC,SAAS,GAAGC,SAAS;OAC/B,CAAC;MAEF,OAAON,WAAW;IACtB;;ICtBA,IAAIO,mBAAmC;IAEvC;;IAEA;MAA4BC;;;;MA0BxB,uBAAmBC,SAAmD;QAAnD,0BAAA;UAAAA,kBAAmD;;QAAtE,YACIC,iBAAO;QADQC,eAAS,GAATF,SAAS;;;QAfrBE,aAAO,GAAG,KAAK;;;QAGfA,YAAM,GAAG,KAAK;;;;QAIdA,cAAQ,GAAG,KAAK;;;;QAIhBA,aAAO,GAAG,KAAK;QAWfA,WAAK,GAAG;UACXA,KAAI,CAACf,OAAO,GAAG,KAAK;UACpBe,KAAI,CAACd,MAAM,GAAG,KAAK;UACnBc,KAAI,CAAChB,QAAQ,GAAG,KAAK;UACrBgB,KAAI,CAACb,OAAO,GAAG,KAAK;UACpB,OAAOa,KAAI;SACd;QAiHOA,kBAAY,GAAG,UAACvB,CAAgB;UACpCuB,KAAI,CAACC,YAAY,CAAC,SAAS,EAAExB,CAAC,CAAC;SAClC;QACOuB,gBAAU,GAAG,UAACvB,CAAgB;UAClCuB,KAAI,CAACC,YAAY,CAAC,OAAO,EAAExB,CAAC,CAAC;SAChC;QACOuB,UAAI,GAAG;UACXA,KAAI,CAACE,KAAK,EAAE;UACZF,KAAI,CAACG,OAAO,CAAC,MAAM,CAAC;SACvB;QApIGC,QAAQ,CAACN,SAAS,EAAE,MAAM,EAAEE,KAAI,CAACK,IAAI,CAAC;QACtCD,QAAQ,CAACN,SAAS,EAAE,SAAS,EAAEE,KAAI,CAACM,YAAY,CAAC;QACjDF,QAAQ,CAACN,SAAS,EAAE,OAAO,EAAEE,KAAI,CAACO,UAAU,CAAC;;;MAChD;MA7BDC,sBAAkBC,uBAAM;;;aAAxB;UACI,OAAOb,mBAAmB,KAAKA,mBAAmB,GAAG,IAAIa,aAAa,EAAE,CAAC;SAC5E;;;;MACaA,uBAAS,GAAvB;QACI,OAAO,IAAI,CAACC,MAAM;OACrB;;;;MAmCM,eAAO,GAAd;QACI,IAAMZ,SAAS,GAAG,IAAI,CAACA,SAAgB;QAEvC,IAAI,CAACI,KAAK,EAAE;QACZ,IAAI,CAACS,GAAG,EAAE;QACVC,WAAW,CAACd,SAAS,EAAE,MAAM,EAAE,IAAI,CAACO,IAAI,CAAC;QACzCO,WAAW,CAACd,SAAS,EAAE,SAAS,EAAE,IAAI,CAACQ,YAAY,CAAC;QACpDM,WAAW,CAACd,SAAS,EAAE,OAAO,EAAE,IAAI,CAACS,UAAU,CAAC;OACnD;;;;MAMM,eAAO,GAAd,UACIM,IAA2D,EAC3DC,QAA0C;QAE1C,OAAO,IAAI,CAACV,QAAQ,CAAC,SAAS,EAAES,IAAI,EAAEC,QAAQ,CAAC;OAClD;;;;MAMM,kBAAU,GAAjB,UACID,IAA2D,EAC3DC,QAA0C;QAE1C,OAAO,IAAI,CAACF,WAAW,CAAC,SAAS,EAAEC,IAAI,EAAEC,QAAQ,CAAC;OACrD;;;;MAMM,gBAAQ,GAAf,UACID,IAA2D,EAC3DC,QAA0C;QAE1C,OAAO,IAAI,CAACF,WAAW,CAAC,OAAO,EAAEC,IAAI,EAAEC,QAAQ,CAAC;OACnD;;;;MAMM,aAAK,GAAZ,UACID,IAA2D,EAC3DC,QAA0C;QAE1C,OAAO,IAAI,CAACV,QAAQ,CAAC,OAAO,EAAES,IAAI,EAAEC,QAAQ,CAAC;OAChD;MACO,gBAAQ,GAAhB,UACIC,IAAyB,EACzBF,IAA2D,EAC3DC,QAA0C;QAE1C,IAAIE,OAAO,CAACH,IAAI,CAAC,EAAE;UACf,IAAI,CAACI,EAAE,CAAC,UAAGF,IAAI,cAAI3B,eAAe,CAACyB,IAAI,CAAC,CAACK,IAAI,CAAC,GAAG,CAAC,CAAE,EAAEJ,QAAQ,CAAC;SAClE,MAAM,IAAIK,QAAQ,CAACN,IAAI,CAAC,EAAE;UACvB,IAAI,CAACI,EAAE,CAAC,UAAGF,IAAI,cAAIF,IAAI,CAAE,EAAEC,QAAQ,CAAC;SACvC,MAAM;UACH,IAAI,CAACG,EAAE,CAACF,IAAI,EAAEF,IAAI,CAAC;;QAEvB,OAAO,IAAI;OACd;MACO,mBAAW,GAAnB,UACIE,IAAyB,EACzBF,IAAuE,EACvEC,QAA0C;QAE1C,IAAIE,OAAO,CAACH,IAAI,CAAC,EAAE;UACf,IAAI,CAACF,GAAG,CAAC,UAAGI,IAAI,cAAI3B,eAAe,CAACyB,IAAI,CAAC,CAACK,IAAI,CAAC,GAAG,CAAC,CAAE,EAAEJ,QAAQ,CAAC;SACnE,MAAM,IAAIK,QAAQ,CAACN,IAAI,CAAC,EAAE;UACvB,IAAI,CAACF,GAAG,CAAC,UAAGI,IAAI,cAAIF,IAAI,CAAE,EAAEC,QAAQ,CAAC;SACxC,MAAM;UACH,IAAI,CAACH,GAAG,CAACI,IAAI,EAAEF,IAAI,CAAC;;QAExB,OAAO,IAAI;OACd;MACO,oBAAY,GAApB,UAAqBE,IAAyB,EAAEtC,CAAgB;QAC5D,IAAI,CAACQ,OAAO,GAAGR,CAAC,CAACQ,OAAO;QACxB,IAAI,CAACD,QAAQ,GAAGP,CAAC,CAACO,QAAQ;QAC1B,IAAI,CAACE,MAAM,GAAGT,CAAC,CAACS,MAAM;QACtB,IAAI,CAACC,OAAO,GAAGV,CAAC,CAACU,OAAO;QAExB,IAAMhB,GAAG,GAAGH,MAAM,CAACS,CAAC,CAACR,OAAO,EAAEQ,CAAC,CAACN,GAAG,CAAC;QACpC,IAAMiD,QAAQ,GAAGjD,GAAG,KAAK,MAAM,IACxBA,GAAG,KAAK,OAAO,IACfA,GAAG,KAAK,MAAM,IACdA,GAAG,KAAK,KAAK;QACpB,IAAMkD,KAAK,GAAoC;UAC3ClD,GAAG,KAAA;UACHiD,QAAQ,UAAA;UACRE,UAAU,EAAE7C,CAAC;UACbR,OAAO,EAAEQ,CAAC,CAACR,OAAO;UAClBgB,OAAO,EAAER,CAAC,CAACQ,OAAO;UAClBC,MAAM,EAAET,CAAC,CAACS,MAAM;UAChBF,QAAQ,EAAEP,CAAC,CAACO,QAAQ;UACpBG,OAAO,EAAEV,CAAC,CAACU;SACd;QACD,IAAI,CAACgB,OAAO,CAACY,IAAI,EAAEM,KAAK,CAAC;QACzB,IAAI,CAAClB,OAAO,CAAC,UAAGY,IAAI,cAAI5C,GAAG,CAAE,EAAEkD,KAAK,CAAC;QAErC,IAAME,KAAK,GAAG/C,QAAQ,CAACC,CAAC,EAAEN,GAAG,CAAC;QAE9BoD,KAAK,CAACC,MAAM,GAAG,CAAC,IAAI,IAAI,CAACrB,OAAO,CAAC,UAAGY,IAAI,cAAIQ,KAAK,CAACL,IAAI,CAAC,GAAG,CAAC,CAAE,EAAEG,KAAK,CAAC;OACxE;MAWL,oBAAC;IAAD,CAlKA,CAA4BI,YAAY;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ICxBxC,IAAIC,WAGF;AAEF,IAAO,IAAMC,QAAQ,GAMjB;MACAC,MAAM,EAAE,CAAC,SAAS,EAAE,OAAO,EAAE,MAAM,CAAC;MACpCC,KAAK,EAAE;QAAEC,SAAS,EAAE;OAAO;MAC3BC,OAAO,EAAP,UAAQC,IAAI;;QACR,IAAI,CAACN,WAAW,EAAE;UACdA,WAAW,GAAG,IAAIO,GAAG,EAAE;;QAE3B,IAAMC,OAAO,GAAG,MAAA,MAAAF,IAAI,CAACG,GAAG,0CAAEC,OAAO,mCAAIC,MAAM;QAE3C,IAAIC,IAAI,GAAGZ,WAAW,CAACa,GAAG,CAACL,OAAO,CAAC;QAEnC,IAAI,CAACI,IAAI,EAAE;UACPA,IAAI,GAAG;YACHE,IAAI,EAAE,IAAI/B,aAAa,CAACyB,OAAO,CAAC;YAChCO,KAAK,EAAE;WACV;UAEDf,WAAW,CAACgB,GAAG,CAACR,OAAO,EAAEI,IAAI,CAAC;;QAElC,EAAEA,IAAI,CAACG,KAAK;QAEZ,IAAME,MAAM,GAAGL,IAAI,CAACE,IAAI;QACxB,IAAM9D,IAAI,GAAGsD,IAAI,CAACtD,IAAI;QACtB,IAAMoD,SAAS,GAAGc,OAAO,CAAC,KAAK,CAAC;QAChC,IAAMC,OAAO,GAAGb,IAAI,CAACa,OAAO;QAE5BF,MAAM,CAACG,OAAO,CAACpE,IAAI,EAAE,UAACD,CAAqB;UACvC,IAAI,CAACoE,OAAO,IAAIA,OAAO,CAACpE,CAAC,CAAC,EAAE;YACxBqD,SAAS,CAACM,OAAO,GAAG,IAAI;;SAE/B,CAAC;QACFO,MAAM,CAACI,KAAK,CAACrE,IAAI,EAAE;UACfoD,SAAS,CAACM,OAAO,GAAG,KAAK;SAC5B,CAAC;QACFO,MAAM,CAAC1B,EAAE,CAAC,MAAM,EAAE;UACda,SAAS,CAACM,OAAO,GAAG,KAAK;SAC5B,CAAC;QAEF,OAAOY,QAAQ,CAAC;UACZR,IAAI,EAAEG,MAAM;UACZjE,IAAI,MAAA;UACJuE,OAAO,EAAE;YAAM,OAAAN,MAAM,CAACM,OAAO,EAAE;WAAA;UAC/BnB,SAAS;SACZ,CAAC;OACL;MACDmB,OAAO,YAACC,EAAQ;YAANV,IAAI,UAAA;QACV,IAAMN,OAAO,GAAGM,IAAI,CAAC1C,SAAS;QAC9B,IAAMwC,IAAI,GAAGZ,WAAW,CAACa,GAAG,CAACL,OAAO,CAAC;QAErC,EAAEI,IAAI,CAACG,KAAK;QACZ,IAAI,CAACH,IAAI,CAACG,KAAK,EAAE;UACbD,IAAI,CAACS,OAAO,EAAE;UACdvB,WAAW,CAACyB,MAAM,CAACjB,OAAO,CAAC;;OAElC;MACDjB,EAAE,EAAF,UAAGuB,IAAI,EAAElE,IAAI,EAAEwC,QAAQ;QACnB,IAAM6B,MAAM,GAAGH,IAAI,CAACA,IAAI;QAExB,IAAIlE,IAAI,KAAK,SAAS,EAAE;UACpBqE,MAAM,CAACG,OAAO,CAACN,IAAI,CAAC9D,IAAI,EAAEoC,QAAe,CAAC;SAC7C,MAAM,IAAIxC,IAAI,KAAK,OAAO,EAAE;UACzBqE,MAAM,CAACI,KAAK,CAACP,IAAI,CAAC9D,IAAI,EAAEoC,QAAe,CAAC;SAC3C,MAAM;UACH6B,MAAM,CAAC1B,EAAE,CAAC3C,IAAI,EAAEwC,QAAe,CAAC;;OAEvC;MACDH,GAAG,EAAH,UAAI6B,IAAI,EAAElE,IAAI,EAAEwC,QAAQ;QACpB,IAAM6B,MAAM,GAAGH,IAAI,CAACA,IAAI;QAExB,IAAIlE,IAAI,KAAK,SAAS,EAAE;UACpBqE,MAAM,CAACS,UAAU,CAACZ,IAAI,CAAC9D,IAAI,EAAEoC,QAAe,CAAC;SAChD,MAAM,IAAIxC,IAAI,KAAK,OAAO,EAAE;UACzBqE,MAAM,CAACU,QAAQ,CAACb,IAAI,CAAC9D,IAAI,EAAEoC,QAAe,CAAC;SAC9C,MAAM;UACH6B,MAAM,CAAChC,GAAG,CAACrC,IAAI,EAAEwC,QAAe,CAAC;;;KAG5C;;;;;;;;;;;;;;ICtGD,KAAK,IAAMxC,IAAI,IAAIgF,MAAM,EAAE;MACtBX,aAAc,CAACrE,IAAI,CAAC,GAAIgF,MAAc,CAAChF,IAAI,CAAC;;;;;;;;;"}