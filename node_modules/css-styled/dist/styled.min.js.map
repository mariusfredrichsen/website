{"version":3,"file":"styled.min.js","sources":["../src/utils.ts","../src/styled.ts"],"sourcesContent":["import stringHash from \"string-hash\";\nimport { getDocument, splitComma } from \"@daybrush/utils\";\nimport { InjectOptions } from \"./types\";\n\nexport function getHash(str: string) {\n    return stringHash(str).toString(36);\n}\nexport function getShadowRoot(parentElement: HTMLElement | SVGElement) {\n    if (parentElement && parentElement.getRootNode) {\n        const rootNode = parentElement.getRootNode();\n\n        if (rootNode.nodeType === 11) {\n            return rootNode as ShadowRoot;\n        }\n    }\n    return;\n}\nexport function replaceStyle(className: string, css: string, options: Partial<InjectOptions>) {\n    if (options.original) {\n        return css;\n    }\n    return css.replace(/([^};{\\s}][^};{]*|^\\s*){/mg, (_, selector) => {\n        const trimmedSelector = selector.trim();\n        return (trimmedSelector ? splitComma(trimmedSelector) : [\"\"]).map(subSelector => {\n            const trimmedSubSelector = subSelector.trim();\n            if (trimmedSubSelector.indexOf(\"@\") === 0) {\n                return trimmedSubSelector;\n            } else if (trimmedSubSelector.indexOf(\":global\") > -1) {\n                return trimmedSubSelector.replace(/\\:global/g, \"\");\n            } else if (trimmedSubSelector.indexOf(\":host\") > -1) {\n                return `${trimmedSubSelector.replace(/\\:host/g, `.${className}`)}`;\n            } else if (trimmedSubSelector) {\n                return `.${className} ${trimmedSubSelector}`;\n            } else {\n                return `.${className}`;\n            }\n        }).join(\", \") + \" {\";\n    });\n}\nexport function injectStyle(className: string, css: string, options: Partial<InjectOptions>, el: Node, shadowRoot?: Node) {\n    const doc = getDocument(el);\n    const style = doc.createElement(\"style\");\n\n    style.setAttribute(\"type\", \"text/css\");\n    style.setAttribute(\"data-styled-id\", className);\n    style.setAttribute(\"data-styled-count\", \"1\");\n\n    if (options.nonce) {\n        style.setAttribute(\"nonce\", options.nonce);\n    }\n    style.innerHTML = replaceStyle(className, css, options);\n\n    (shadowRoot || doc.head || doc.body).appendChild(style);\n    return style;\n}\n","import { getHash, injectStyle, getShadowRoot } from \"./utils\";\nimport { StyledInjector, InjectOptions } from \"./types\";\n\n/**\n * Create an styled object that can be defined and inserted into the css.\n * @param - css styles\n */\nfunction styled(css: string): StyledInjector {\n    const injectClassName = \"rCS\" + getHash(css);\n\n    return {\n        className: injectClassName,\n        inject(el: HTMLElement | SVGElement, options: Partial<InjectOptions> = {}) {\n            const shadowRoot = getShadowRoot(el);\n            let styleElement = (shadowRoot || el.ownerDocument || document).querySelector<HTMLStyleElement>(`style[data-styled-id=\"${injectClassName}\"]`);\n\n            if (!styleElement) {\n                styleElement = injectStyle(injectClassName, css, options, el, shadowRoot);\n            } else {\n                const count = parseFloat(styleElement.getAttribute(\"data-styled-count\")) || 0;\n                styleElement.setAttribute(\"data-styled-count\", `${count + 1}`);\n            }\n            return {\n                destroy() {\n                    const injectCount = parseFloat(styleElement.getAttribute(\"data-styled-count\")) || 0;\n\n                    if (injectCount <= 1) {\n                        if (styleElement.remove) {\n                            styleElement.remove();\n                        } else {\n                            styleElement.parentNode?.removeChild(styleElement);\n                        }\n                        styleElement = null;\n                    } else {\n                        styleElement.setAttribute(\"data-styled-count\", `${injectCount - 1}`);\n                    }\n                },\n            };\n        },\n    };\n}\n\nexport * from \"./types\";\nexport default styled;\n"],"names":["replaceStyle","className","css","options","original","replace","_","selector","trimmedSelector","trim","map","subSelector","trimmedSubSelector","indexOf","join","injectStyle","el","shadowRoot","doc","style","createElement","setAttribute","nonce","innerHTML","head","body","appendChild","injectClassName","stringHash","toString","inject","count","parentElement","getRootNode","rootNode","nodeType","styleElement","ownerDocument","document","querySelector","parseFloat","getAttribute","destroy","injectCount","remove","parentNode","removeChild"],"mappings":";;;;;;;;k1EAiBgBA,EAAaC,EAAmBC,EAAaC,GACzD,OAAIA,EAAQC,SACDF,EAEJA,EAAIG,QAAQ,6BAA8B,SAACC,EAAGC,GAC3CC,EAAkBD,EAASE,OACjC,OAAQD,IAA6BA,OAAmB,CAAC,KAAKE,IAAI,SAAAC,GACxDC,EAAqBD,EAAYF,OACvC,OAAwC,IAApCG,EAAmBC,QAAQ,GAAG,EACvBD,EACwC,CAAC,EAAzCA,EAAmBC,QAAQ,SAAS,EACpCD,EAAmBP,QAAQ,YAAa,EAAE,EACJ,CAAC,EAAvCO,EAAmBC,QAAQ,OAAO,EAClC,UAAGD,EAAmBP,QAAQ,UAAW,WAAIJ,CAAS,CAAE,CAAC,EACzDW,EACA,WAAIX,cAAaW,CAAkB,EAEnC,WAAIX,CAAS,EAE3B,EAAEa,KAAK,IAAI,EAAI,KACnB,CACL,UACgBC,EAAYd,EAAmBC,EAAaC,EAAiCa,EAAUC,GACnG,IAAMC,YAAkBF,8BAClBG,EAAQD,EAAIE,cAAc,OAAO,EAYvC,OAVAD,EAAME,aAAa,OAAQ,UAAU,EACrCF,EAAME,aAAa,iBAAkBpB,CAAS,EAC9CkB,EAAME,aAAa,oBAAqB,GAAG,EAEvClB,EAAQmB,OACRH,EAAME,aAAa,QAASlB,EAAQmB,KAAK,EAE7CH,EAAMI,UAAYvB,EAAaC,EAAWC,EAAKC,CAAO,GAErDc,GAAcC,EAAIM,MAAQN,EAAIO,MAAMC,YAAYP,CAAK,EAC/CA,CACX,QC/CA,SAAgBjB,GACZ,IAAMyB,EAAkB,MDHjBC,ECGiC1B,CDHnB,EAAE2B,SAAS,EAAE,ECKlC,MAAO,CACH5B,UAAW0B,EACXG,OAAA,SAAOd,EAA8Bb,gBAAAA,MACjC,IAMU4B,EANJd,WDNYe,GAC1B,GAAIA,GAAiBA,EAAcC,YAAa,CACtCC,EAAWF,EAAcC,cAE/B,GAA0B,KAAtBC,EAASC,SACT,OAAOD,EAInB,ECH6ClB,CAAE,EAC/BoB,GAAgBnB,GAAcD,EAAGqB,eAAiBC,UAAUC,cAAgC,gCAAyBZ,OAAmB,EAQ5I,OANKS,GAGKL,EAAQS,WAAWJ,EAAaK,aAAa,mBAAmB,CAAC,GAAK,EAC5EL,EAAaf,aAAa,oBAAqB,UAAGU,EAAQ,CAAC,CAAE,GAH7DK,EAAerB,EAAYY,EAAiBzB,EAAKC,EAASa,EAAIC,CAAU,EAKrE,CACHyB,yBACUC,EAAcH,WAAWJ,EAAaK,aAAa,mBAAmB,CAAC,GAAK,EAE9EE,GAAe,GACXP,EAAaQ,OACbR,EAAaQ,SAEb,SAAAR,EAAaS,eAAYC,YAAYV,CAAY,EAErDA,EAAe,MAEfA,EAAaf,aAAa,oBAAqB,UAAGsB,EAAc,CAAC,CAAE,KAM3F"}