{"version":3,"file":"styled.js","sources":["../src/utils.ts","../src/styled.ts"],"sourcesContent":["import stringHash from \"string-hash\";\nimport { getDocument, splitComma } from \"@daybrush/utils\";\nimport { InjectOptions } from \"./types\";\n\nexport function getHash(str: string) {\n    return stringHash(str).toString(36);\n}\nexport function getShadowRoot(parentElement: HTMLElement | SVGElement) {\n    if (parentElement && parentElement.getRootNode) {\n        const rootNode = parentElement.getRootNode();\n\n        if (rootNode.nodeType === 11) {\n            return rootNode as ShadowRoot;\n        }\n    }\n    return;\n}\nexport function replaceStyle(className: string, css: string, options: Partial<InjectOptions>) {\n    if (options.original) {\n        return css;\n    }\n    return css.replace(/([^};{\\s}][^};{]*|^\\s*){/mg, (_, selector) => {\n        const trimmedSelector = selector.trim();\n        return (trimmedSelector ? splitComma(trimmedSelector) : [\"\"]).map(subSelector => {\n            const trimmedSubSelector = subSelector.trim();\n            if (trimmedSubSelector.indexOf(\"@\") === 0) {\n                return trimmedSubSelector;\n            } else if (trimmedSubSelector.indexOf(\":global\") > -1) {\n                return trimmedSubSelector.replace(/\\:global/g, \"\");\n            } else if (trimmedSubSelector.indexOf(\":host\") > -1) {\n                return `${trimmedSubSelector.replace(/\\:host/g, `.${className}`)}`;\n            } else if (trimmedSubSelector) {\n                return `.${className} ${trimmedSubSelector}`;\n            } else {\n                return `.${className}`;\n            }\n        }).join(\", \") + \" {\";\n    });\n}\nexport function injectStyle(className: string, css: string, options: Partial<InjectOptions>, el: Node, shadowRoot?: Node) {\n    const doc = getDocument(el);\n    const style = doc.createElement(\"style\");\n\n    style.setAttribute(\"type\", \"text/css\");\n    style.setAttribute(\"data-styled-id\", className);\n    style.setAttribute(\"data-styled-count\", \"1\");\n\n    if (options.nonce) {\n        style.setAttribute(\"nonce\", options.nonce);\n    }\n    style.innerHTML = replaceStyle(className, css, options);\n\n    (shadowRoot || doc.head || doc.body).appendChild(style);\n    return style;\n}\n","import { getHash, injectStyle, getShadowRoot } from \"./utils\";\nimport { StyledInjector, InjectOptions } from \"./types\";\n\n/**\n * Create an styled object that can be defined and inserted into the css.\n * @param - css styles\n */\nfunction styled(css: string): StyledInjector {\n    const injectClassName = \"rCS\" + getHash(css);\n\n    return {\n        className: injectClassName,\n        inject(el: HTMLElement | SVGElement, options: Partial<InjectOptions> = {}) {\n            const shadowRoot = getShadowRoot(el);\n            let styleElement = (shadowRoot || el.ownerDocument || document).querySelector<HTMLStyleElement>(`style[data-styled-id=\"${injectClassName}\"]`);\n\n            if (!styleElement) {\n                styleElement = injectStyle(injectClassName, css, options, el, shadowRoot);\n            } else {\n                const count = parseFloat(styleElement.getAttribute(\"data-styled-count\")) || 0;\n                styleElement.setAttribute(\"data-styled-count\", `${count + 1}`);\n            }\n            return {\n                destroy() {\n                    const injectCount = parseFloat(styleElement.getAttribute(\"data-styled-count\")) || 0;\n\n                    if (injectCount <= 1) {\n                        if (styleElement.remove) {\n                            styleElement.remove();\n                        } else {\n                            styleElement.parentNode?.removeChild(styleElement);\n                        }\n                        styleElement = null;\n                    } else {\n                        styleElement.setAttribute(\"data-styled-count\", `${injectCount - 1}`);\n                    }\n                },\n            };\n        },\n    };\n}\n\nexport * from \"./types\";\nexport default styled;\n"],"names":["getHash","str","stringHash","toString","getShadowRoot","parentElement","getRootNode","rootNode","nodeType","replaceStyle","className","css","options","original","replace","_","selector","trimmedSelector","trim","splitComma","map","subSelector","trimmedSubSelector","indexOf","join","injectStyle","el","shadowRoot","doc","getDocument","style","createElement","setAttribute","nonce","innerHTML","head","body","appendChild","styled","injectClassName","inject","styleElement","ownerDocument","document","querySelector","count","parseFloat","getAttribute","destroy","injectCount","remove","parentNode","removeChild"],"mappings":"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"}